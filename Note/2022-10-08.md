# 2022-10-08 OI笔记

## CF793F Julia the snail

题意简述: 有一个长度为 $n$ 的杆,上面有 $m$ 条绳子,第 $i$ 条绳子可以让蜗牛从 $l_i$ 爬到 $r_i$ (中途不能停止),蜗牛也可以自由下落, $q$ 次询问蜗牛从 $x$ 出发,途中高度不能低于 $x$ 或高于 $y$ ,问能爬到的最高高度, $n,m,q \le 10^5$

思考时间: $20min$

考虑枚举右端点,把绳子和询问按 $r$ 排序,然后依次扩展 $r$ 的限制,然后就解决了 $r$ 的限制

如果蜗牛可以从 $a$ 走到 $b$ ,那么在杆上 $a$ 到 $b$ 这个范围都应该被绳子覆盖,这个可以用线段树二分找到 $[x,y]$ 内第一个没覆盖到的位置,但是注意到不可以使用左端点低于 $l$ 的绳子,我们在线段树上维护能到达这个位置的 $l_i$ 最大的绳子(如果没有那就是 $0$ )的左端点位置,每次加入一条线段 $[l_i,r_i]$ 时将线段树 $[l_i,r_i-1]$ 这个区间对 $l_i$ 取 $\max$ ,然后维护区间最小值,线段树二分找到 $[x,y]$ 中最靠左的小于 $x$ 的位置即可

## P3488 [POI2009]LYZ-Ice Skates

题意简述: 有号码 $1,2,...,n$ 的鞋各 $k$ 双, $x$ 号脚的人可以穿 $[x,x+d]$ 号码的鞋,有 $m$ 次操作,每次操作来 $x$ 个 $r$ 号脚的人( $x$ 可以为负),每次操作后询问鞋是否足够

思考时间: 看题解了

Hall定理: 

Let $G$ be a bipartite graph with partition $X,Y$ .

$G$ contains a matching of $X$ if and only if $\forall S \subseteq X,|N(S)| \ge |S| $ .

翻译: 对于一个二部图 $G~(X,Y)$ , $X$ 存在一个匹配的充分必要条件是 $\forall S \subseteq X,|N(S)| \ge |S|$ , $N(S)$ 为 $S$ 的邻居集合

必要性证明: $\forall S \subseteq X$ ,对于 $S$ 中的每一个点,都可以在 $Y$ 中找到一个匹配,故有 $S$ 的匹配点 $\subseteq$ $N(S)$ , 因此 $|N(S)| \ge |S| ,必要性显然$

充分性证明: 反证法, 假设 $G$ 的最大匹配 $M$ 不是 $X$ 的一个匹配, $X$ 中至少存在一个点 $u$ 未匹配,该点至少与一条不属于 $M$ 的边连接,改边的另一个顶点如果未匹配,就不满足 $M$ 是 $G$ 的最大匹配,否则沿着交错路走下去,因为 $|N(S) \ge |S|$ ,每次走到 $X$ 中的一个点,一定能找到一条未选的边走到 $Y$ 中的一个点,最终一定会停止在 $Y$ 中的一个未匹配点,与假设矛盾,故充分性成立

回到题目,如果不考虑数据范围,询问等价于是否存在完美匹配,令 $a_i$ 表示 $i$ 号脚的人的数量,那么 $\forall 1 \le l \lt r \le n,\sum_{l \le i \le r}a_i \le (r-l+1+d)k$

用线段树维护序列 $a$ 的最大子段和即可

# 2022-10-09 OI笔记

## AtCoder Regular Contest 150

### B

给定整数 $A,B$ , 求出正整数 $X,Y$ 使 $(B+Y)$ 是 $(A+X)$ 的因数 ( $A,B \le 10^9$)

首先答案的上限为 $A-1$

考虑根号分治:

$A \le \sqrt{B}$ :枚举 $X$ , $X$ 不会超过 $A$ , 枚举量为 $\sqrt{B}$

$A \gt \sqrt{B}$ :枚举 $(B+Y)$ 是 $(A+X)$ 的多少倍,倍数为 $k$ , $k(A+X) \ge B$ 时 $k$ 继续增加没有意义,枚举量为 $\sqrt{B}$

### C

给定一张图,每个节点有一个数字,判断序列 $B$ 是否是所有从节点 $1$ 到节点 $n$ 的序列的子序列

考虑 Dijkstra ,把 $dis_i$ 定义为到第 $i$ 个节点路径最少包含 $B$ 前 $dis_i$ 个元素,然后判断 $dis_n = |B|$ 即可

# 2022-10-10 OI笔记

## pyyz 模拟赛

### T2

给定一个树,每个节点有一个权值,选择尽可能少的路径使每个节点的被覆盖次数等于这个节点的权值

先对每一个点单独处理,花费为权值之和

考虑合并路径,对于一个点最多可以于相邻的两个点匹配,于是答案变为了最大匹配

然后DP, $f_i$ 表示子树 $i$ 的最大匹配数量, $g_i$ 表示在匹配数量最大的时候 $i$ 上有多少个节点可以和父亲匹配

### T3

给定若干链或者环,每个节点可以染成 $[1,a_i]$ 的颜色,询问方案数

考虑链,朴素的DP可以维护前 $i$ 个节点最后一个节点为 $j$ 的方案数,发现DP值可以用线段树来维护

然后是环,关键的一点是拿 $a_i$ 最小的一个点为起点然后断环成链,然后钦定第一个点的颜色为 $1$ ,然后求出最后一个节点也为 $1$ 的方案数,答案减去 $a_1$ 倍的方案数,拿最小的点为起点的原因是整体是等价的,后面没有更小的所以没有影响

# 2022-10-11 OI笔记

## whc出的题

求 $f(x,y)=\sum_{n=0}^ \infty {n \choose x}{n \choose y} \frac{1}{2^n}$

$1 \le x,y \le 10^3$

考虑组合数递推式: ${n \choose x}={n-1 \choose x}+{n-1 \choose x-1}$

$f(x,y)=\sum_{n=0}^ \infty ({n-1 \choose x}+{n-1 \choose x-1})({n-1 \choose y}+{n-1 \choose y-1}) \frac{1}{2^n}$

$f(x,y)=\frac{1}{2}(f(x,y)+f(x,y-1)+f(x-1,y)+f(x-1,y-1))$

$f(x,y)=f(x,y-1)+f(x-1,y)+f(x-1,y-1)$

考虑边界

$f(0,0)=\sum_{n=0}^ \infty \frac{1}{2^n}=2$

$f(0,k)=\sum_{n=0}^ \infty {n \choose k} \frac{1}{2^n} =\sum_{n=0}^ \infty ({n-1 \choose k}+{n-1 \choose k-1}) \frac{1}{2^n}=\frac{1}{2}(f(0,k)+f(0,k-1)$

$f(0,k)=f(0,k-1)$

## P6877 [JOI 2020 Final] 長いだけのネクタイ

有 $N+1$ 条领带,第 $i$ 条领带的长度为 $A_i$ ,有 $N$ 名员工,每个人带着一个长度为 $B_i$ 的领带

去除一条领带然后让 $N$ 个员工换上剩下的 $N$ 条领带,如果一个人领带长度从 $a$ 变为 $b$ 此人的不合适度为 $\max\{0,a-b\}$ ,总体的不合适度为所有人不合适度的最大值

对于每一条领带,你要让去除他后分配剩余领带的不合适度尽可能小,求出这个最小值

可以证明贪心的排序 $A$ 和 $B$ 然后依次对应是最优的,那么只需要维护前后缀的最大不合适度然后合并即可

# 2022-10-12 OI笔记

## pyyz模拟赛

### T4

有 $n$ 棵树,每棵树初始只有根节点,根节点为生长节点,有两种操作

1. 编号在 $[l,r]$ 之间的所有树从生长节点长出一个子节点,生长节点变为新节点

2. 编号在 $[l,r]$ 之间的所有树的生长节点变为生长节点的父节点

有一种询问,每次询问某棵树生长节点为根的子树大小

询问和操作共 $m$ 次, $1 \le n,m \le 5 \times 10^5$

观察操作的性质,发现和树的括号序有关系,1操作相当于在后面画一个左括号,2操作相当于在后面画一个右括号,询问相当于找到尽可能靠后的一个后缀让右括号数量大于左括号数量,然后答案就是这个后缀内的左括号数量

转换完题目之后发现我们可以差分每一次操作,然后扫描这 $n$ 棵树,线段树维护操作序列,然后线段树二分找到位置即可,时间复杂度  $O(n \log n)$

比赛的时候降智用线段树分治维护了操作,突然发现多一个 $\log$ ,操作存在逆操作,直接扫描就足够了

# 2022-10-14 OI笔记

## 错排问题

考虑一个有 $n$ 个元素的排列,若一个排列中所有的元素都不在自己原来的位置上,那么这样的排列就称为原排列的一个错排, $n$ 个元素的错排数记为 $D_n$ 或 $!n$

结论: $D_1=0,D_2=1,D_n=(n-1)(D_{n-2}+D_{n-1})$

证明: 考虑一个 $n$ 个元素的错排, $n$ 一定不在第 $n$ 个位置上,假定 $n$ 在位置 $k$ , $1 \le k \le n-1$ , $k$ 一共有 $n-1$ 种等价的选择,然后考虑两种情况

1. $k$ 在位置 $n$ ,剩下的 $n-2$ 个元素恰好是 $n-2$ 个元素的错排

2. $k$ 不在位置 $n$ ,因此可以把位置 $n$ 假定为位置 $k$ ,然后方案就是 $n-1$ 个元素的错排

所以 $n$ 在位置 $k$ 一共有 $D_{n-2}+D_{n-1}$ 种方案, $D_n=(n-1)(D_{n-2}+D_{n-1})$

从这个公式中我们可以求出 $D$ 的通项公式

令 $D_n=n!M_n$ ,则 $M_1=0,M_2=\frac{1}{2}$

$$n!M_n=(n-1)((n-2)!M_{n-2}+(n-1)!M_{n-1})$$

$$n(n-1)!M_n=(n-1)!M_{n-2}+(n-1)(n-1)!M_{n-1}$$

$$nM_n=M_{n-2}+nM_{n-1}-M_{n-1}$$

$$M_n-M_{n-1}=-\frac{1}{n}(M_{n-1}-M_{n-2})$$

$$M_n-M_{n-1}=\prod_{i=3}^n(-\frac{1}{i})(M_2-M_1)=(-1)^n\frac{1}{n!}$$

$$M_n=\sum_{i=2}^n(-1)^i\frac{1}{i!}$$

$$D_n=n!M_n=n!\sum_{i=2}^n(-1)^i\frac{1}{i!}$$

可以写成: $!n=D_n$

## 模拟赛题目

询问所有 $n$ 个元素的错排的逆序对数量

考虑每两个元素 $x,y(x \lt y)$ 对答案的贡献,这样的数对共 $\frac{n(n-1)}{2}$ 对

建立一些双射

如果 $a_x \not= y,a_y \not= x$ ,那么 $swap(a_x,a_y)$ 即可构成双射

如果 $a_x=y,a_y=x$ , 那么本身就是逆序对

如果 $a_x=y,a_y \not= x$ , 如果 $x \lt a_y \lt y$ , 那么令 $a_x=a_y,a_y=x$ 即可构成双射 , 否则本身就是逆序对

然后统计答案即可

# 2022-10-16 OI笔记

## Codeforces Global Round 23

### E1/2

交互题,你需要猜一个数 $x$ , $1 \le x \le 100000$ , 每次可以询问 $x$ 是否属于某个集合 $S$ , 交互机有时会说错误回答,但保证相邻两次询问至少有一次正确回答,在猜数的时候有一次猜错机会,询问次数不能超过 $82(easy),53(hard)$

考虑把四个数分为一组,询问一次 $1,3$ ,询问一次 $2,3$ ,然后发现可以排除一个数(一定有一个数和两次询问结果都矛盾),然后大概 $\log_{\frac{3}{4}}100000 \approx 76$ 次操作即可排除到仅剩 $3$ 个数

假定最后三个数是 $1,2,3$

询问 $1,2$ ,如果回答不在,那么回答 $3$ , 如果错误代表第一次询问结果是假的,下一次一定是真的,然后询问 $1$ 即可确定

如果回答在,再问一次,两次都是在那就是真在,如果后一次说不在同第一种情况

最终询问次数不会超过 $82$ ,(题目给的限制略微宽松一点)

注意到每次缩减的时候询问了两次,我们能利用上一次询问再额外询问一次,假设答案在集合 $A \cup B$ 内,上一次询问结果说答案在集合 $A$ ,那么我们从集合 $A,B$ 各取出一半组成一个集合进行询问,询问刚好卡到 $53$

### F

维护一个序列支持单点修改区间查所有数在区间内出现次数是否是 $k$ 的倍数

考虑随机化,每次把一个集合里的数全当作 $1$ ,其他数当作 $0$ ,处理一遍所有询问,如果一个询问满足要求,那么在所有随机结果下都是满足要求的,如果随机 $k$ 次那么正确率为 $\frac{1}{2^k}$ 

一开始使用 srand WA了,改成 mt19937 就过了





















