# CSP-S 2022 solution

## T1 假期计划(holiday)

### 题意简述

给定一张 $n$ 个点 $m$ 条边的无相图,你需要规划一条 $1 \rightarrow a \rightarrow b \rightarrow c \rightarrow d \rightarrow 1$ 的路线, $a,b,c,d$ 四个点互不相同,相邻两个点在途中之多经过 $k$ 个中转点互相到达,最大化四个点的权值之和

$n \le 2500,m \le 10000,k \le 100$

### 题解

首先以每个点为起点跑最短路预处理出所有点对之间的距离,然后我们去枚举 $b$ 和 $c$ ,然后对于每个点 $x$ ,我们预处理出所有可以 $1 \rightarrow i \rightarrow x$ 的点 $i$ , 保留最大的 $3$ 个,然后我们 $a$ 和 $d$ 就在这 $3$ 个中枚举,保留三个的目的是防止出现 $a=d,a=c,b=d$ 这种重复

因为边权为 $1$ ,在求最短路时使用queue,时间复杂度 $O(n^2)$

## T3 星战(galaxy)

### 题意简述

给一张 $n$ 个点 $m$ 条边的有向图,有若干操作,每次操作之后询问这张图目前是否是外向基环树森林(每个点的出度恰好为 $1$),操作有以下几种

1.删除一个点所有入边

2.恢复一个点所有入边

3.删除一条边

4.恢复一条边

$n,m,q \le 5 \times 10^5$

### 题解

#### 方法1

维护每个点的出度,然后前两个操作就枚举所有的入边,然后修改这些边所有起点的出度,每次判断是否所有点的出度为 $1$ 即可

时间复杂度 $O(mq)$

预计得分:32

#### 方法2

测试点 $9~10$ 中因为没有删除/恢复一个点所有入边操作,也就是说每次操作只会影响到一条边,也就是影响一个点的出度

我们使用一个变量维护出度为 $1$ 的点的数量,如果一个点出度变为 $1$ 或从 $1$ 变为其他值这个变量就会改变,每次判断是否这个变量是否等于 $n$ 即可

预计得分:50

#### 方法3

测试点 $11~12$ 中没有恢复一个点所有入边操作

我们记录一下每个点是否所有入边都没了,如果都没了那么对于这个点的恢复所有入边操作就无效不需要处理了,每个点的操作至多 $1$ 次


预计得分:58

#### 正解

考虑到所有点出度都为 $1$ 的限制非常的特殊,考虑这个限制带来的性质,考虑哈希,如果给每个点 $i$ 赋一个权值 $v_i$ ,令每一个点的出度 $outdeg_i$ ,那么如果满足限制一定满足 $\sum_{i=1}^n outdeg_i v_i=\sum_{i=1}^nv_i$ ,如果不满足限制,这两者相等的概率时极小的,如果不放心可以多重复随机几次进一步提高正确率

对于每个点我们求出他所有出边指向点的点权和和当先存在的出边指向点权和,前两个操作就直接恢复/清空这个点的贡献即可,后两个操作直接计算这一条边的贡献即可,时间复杂度为 $O(q+m)$

预计得分:100
